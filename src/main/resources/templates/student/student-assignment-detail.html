<!DOCTYPE html>

<html>

<head>
	<title>Courses</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" th:href="@{/css/student/student-navbar.css}">

	<link rel="stylesheet" th:href="@{/css/student/student-assignment-detail.css}">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

	<nav>
		<i class="fa fa-mortar-board"></i>
		<h1>STUDENT MANAGEMENT SYSTEM</h1>
		<ul>
			<li>
				<a><i class="fa fa-user-circle"></i><span th:text="${student.firstName}"></span></a>
				<ul class="dropdown">
					<li>
						<form action="#" th:action="@{/logout}" method="POST">
							<input type="submit" value="Logout"></input>
						</form>
					</li>
				</ul>
			</li>
		</ul>
	</nav>

	<div class="vertical-navbar">
		<ul th:each="course : ${courses}">
			<li><a th:href="@{/student/{studentId}/courses/{courseId}(studentId=${student.id}, courseId=${course.id})}"><i
						class="fa fa-tag fa-navbar"></i><span th:text="${course.code}"></span></a></li>
		</ul>
	</div>




	<div class="content">

		<h3>Assignment</h3>

		<span>Name:</span>
		<div th:text="${assignment.title}"></div>
		<span>Description:</span>
		<div th:text="${assignment.description}"></div>
		<span>Due Date:</span>
		<div th:text="${assignment.dueDate}"></div>
		<span>Days Left:</span>
		<div th:if="${assignment.daysRemaining >= 0}" th:text="${assignment.daysRemaining}"></div>
		<div th:if="${assignment.daysRemaining < 0}">Overdue</div>
		<span>Status:</span>
		<div th:if="${assignmentDetails != null}">
			<div th:if="${assignmentDetails.isDone == 0}">
				<a class="button"
					th:data-url="@{/student/{studentId}/courses/{courseId}/markAsCompleted/{assignmentId}(studentId=${student.id}, courseId=${course.id}, assignmentId=${assignmentDetails.getAssignmentId()})}"
					onclick="openModal('Complete', this.getAttribute('data-url'))">Mark as completed</a>
			</div>

			<div th:if="${assignmentDetails.isDone == 1}">
				<span id="completed" style="margin-right: 15px;">Completed</span>
				<br>
				<a class="button" style="background-color: #f44336; color: white; width: 180px;"
					th:data-url="@{/student/{studentId}/courses/{courseId}/markAsIncomplete/{assignmentId}(studentId=${student.id}, courseId=${course.id}, assignmentId=${assignmentDetails.getAssignmentId()})}"
					onclick="openModal('Unfinished', this.getAttribute('data-url'))">Mark as unfinished</a>
			</div>

			<!-- The Modal -->
			<div id="confirmModal" class="modal">
				<div class="modal-content">
					<h3 id="modalTitle">Confirm Action</h3>
					<p id="modalMessage">Are you sure you want to proceed?</p>
					<div class="modal-buttons">
						<a id="modalConfirmBtn" class="btn-confirm" href="#">Yes</a>
						<button class="btn-cancel" onclick="closeModal()">Cancel</button>
					</div>
				</div>
			</div>

			<script>
				var modal = document.getElementById("confirmModal");
				var modalTitle = document.getElementById("modalTitle");
				var modalMessage = document.getElementById("modalMessage");
				var modalConfirmBtn = document.getElementById("modalConfirmBtn");

				function openModal(action, url) {
					modal.style.display = "block";
					modalConfirmBtn.href = url;

					if (action === 'Complete') {
						modalTitle.innerText = "Confirm Completion";
						modalMessage.innerText = "Are you sure you want to mark this assignment as completed?";
						modalConfirmBtn.innerText = "Yes, Complete";
						modalConfirmBtn.style.backgroundColor = "#4CAF50"; // Green
					} else {
						modalTitle.innerText = "Confirm Undo";
						modalMessage.innerText = "Are you sure you want to mark this assignment as unfinished?";
						modalConfirmBtn.innerText = "Yes, Mark Unfinished";
						modalConfirmBtn.style.backgroundColor = "#f44336"; // Red
					}
				}

				function closeModal() {
					modal.style.display = "none";
				}

				window.onclick = function (event) {
					if (event.target == modal) {
						modal.style.display = "none";
					}
				}
			</script>
		</div>
		<div th:if="${assignmentDetails == null}">
			<span id="incomplete">Not Started</span>
		</div>

		<!-- Grade Display Section -->
		<div th:if="${assignmentGrade != null}"
			style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
			<h3>Grade Details</h3>
			<span>Grade:</span>
			<div style="font-weight: bold; font-size: 1.2em; color: #4CAF50;" th:text="${assignmentGrade.grade}"></div>

			<span>Score:</span>
			<div><span th:text="${assignmentGrade.score}"></span> / <span th:text="${assignmentGrade.maxScore}"></span>
			</div>

			<span th:if="${assignmentGrade.feedback != null}">Feedback:</span>
			<div th:if="${assignmentGrade.feedback != null}" th:text="${assignmentGrade.feedback}"
				style="font-style: italic; color: #666;"></div>
		</div>
		<div th:if="${assignmentGrade == null && assignmentDetails != null && assignmentDetails.isDone == 1}"
			style="margin-top: 20px; color: #888;">
			<em>Waiting for grade...</em>
		</div>




	</div>




	</div>
</body>

</html>